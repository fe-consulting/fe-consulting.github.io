{"data":{"markdownRemark":{"html":"<h2 id=\"state-management-with-ngrxintroduction\"><a href=\"#state-management-with-ngrxintroduction\" aria-label=\"state management with ngrxintroduction permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>State Management with NGRXâ€Šâ€”â€ŠIntroduction</h2>\n<p><img src=\"https://cdn-images-1.medium.com/max/1600/1*dlu3ZwrnKXqG1vMbsiemxQ.png\"></p>\n<p>In this article, I want to introduce you to the concepts that make up the NGRX platform and all its pieces to fully understand how it helps us create better applications.</p>\n<p><em>NGRX</em>, for those who donâ€™t know yet, is a <em>Redux</em> library for <em>Angular</em>. It helps us with state management, which is arguably the hardest part to manage for modern, large scale, client-side applications.</p>\n<p>Compared to <em>Redux</em>, which only provides the layer for the store, <em>NGRX</em> comes with quite a few powerful features.</p>\n<hr>\n<p>This is the first part of a 4-part articles series that will cover:</p>\n<ul>\n<li>Pillars of NGRX</li>\n<li>How to architect our Store using reducers and entities</li>\n<li>Managing and testing side effects</li>\n<li>Connecting our UI to a Facade Service, with pros and cos</li>\n</ul>\n<h2 id=\"why-ngrx-or-any-state-management-solution\"><a href=\"#why-ngrx-or-any-state-management-solution\" aria-label=\"why ngrx or any state management solution permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why NGRX, or any state management solution</h2>\n<p>NGRX, and other state management libraries for Angular (NGXS, Akita) have become important pieces in the architecture of complex web apps.</p>\n<p>An unpopular opinion of mine is that every Angular application should use some sort of state management, be it RX-powered services, MobX, or different Redux implementations.</p>\n<p>I found several pitfalls with large (and even small) projects using local state within components, such as:</p>\n<ul>\n<li>difficulty in passing data between routes</li>\n<li>difficulty in caching data already fetched</li>\n<li>repeated logic and requests</li>\n<li>no conventions</li>\n</ul>\n<p>This list could be much longer, but this is enough to convince me that some sort of state management is essential for not refactoring a new application any time soon.</p>\n<h2 id=\"ngrx-pillars\"><a href=\"#ngrx-pillars\" aria-label=\"ngrx pillars permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NGRX Pillars</h2>\n<p>Letâ€™s see how the platform around <em>NGRX</em> is structured:</p>\n<ul>\n<li><code class=\"language-text\">store</code>â€Šâ€”â€Šwhich a central repository from which we can <em>select</em> the state from every component and service within the Angular DI</li>\n<li><code class=\"language-text\">effects</code>â€Šâ€”â€Šwhich as the name suggests are side effects that happen when an action is dispatched</li>\n<li><code class=\"language-text\">entity</code>â€Šâ€”â€Šan entity framework to help reduce the usual boilerplate</li>\n</ul>\n<p>Letâ€™s now take a more detailed look at all the concepts weâ€™re going to explore in the next steps.</p>\n<h2 id=\"store\"><a href=\"#store\" aria-label=\"store permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Store</h2>\n<p>A store is a central repository where we store our data.</p>\n<p>Itâ€™s our application database and the only source of truth in our client. Technically speaking, itâ€™s simply a nested object that we use to select and store data.</p>\n<p>As the <em>Store</em> service is accessible via the Angular DI, the data in our store is accessible by all components and services from everywhere in our application.</p>\n<p>Any information regarding state, unless isolated to one single part of the application (ex. forms, popups, transient state), should probably be stored in the store.</p>\n<h2 id=\"actions\"><a href=\"#actions\" aria-label=\"actions permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Actions</h2>\n<p>In NGRX-speakâ€Šâ€”â€Šactions are classes that hold information that gets passed to reducers or that trigger side effects.</p>\n<p>Actions have two parameters:</p>\n<ul>\n<li>a unique identifier we name <code class=\"language-text\">type</code> (make sure you mark it as <code class=\"language-text\">readonly</code>)</li>\n<li>an optional <code class=\"language-text\">payload</code> property that represents the data being passed to the action</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">enum</span> LoginActionTypes <span class=\"token punctuation\">{</span>  \n    LoginButtonClicked <span class=\"token operator\">=</span> <span class=\"token string\">'[Login Button] LOGIN_BUTTON_CLICKED'</span><span class=\"token punctuation\">,</span>  \n    LoginRequestStarted <span class=\"token operator\">=</span> <span class=\"token string\">'[Login API] LOGIN_REQUEST_STARTED'</span>  \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginButtonClicked</span> <span class=\"token punctuation\">{</span>  \n   <span class=\"token keyword\">public</span> <span class=\"token keyword\">readonly</span> <span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> LoginActionTypes<span class=\"token punctuation\">.</span>LoginButtonClicked<span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">public</span> payload<span class=\"token punctuation\">:</span> LoginRequestPayload</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginRequestStarted</span> <span class=\"token punctuation\">{</span>  \n   <span class=\"token keyword\">public</span> <span class=\"token keyword\">readonly</span> <span class=\"token keyword\">type</span> <span class=\"token operator\">=</span> LoginActionTypes<span class=\"token punctuation\">.</span>LoginRequestStarted<span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">public</span> payload<span class=\"token punctuation\">:</span> LoginRequestPayload</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> UserActions <span class=\"token operator\">=</span> LoginButtonClicked <span class=\"token operator\">|</span> LoginRequestStarted<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Conventions for naming the <code class=\"language-text\">type</code> parameter:</p>\n<ul>\n<li>you will usually see the type being written using the format <code class=\"language-text\">[prefix] NAME</code></li>\n<li>the prefix is useful to declare where the request is originated from, as recommended by the NGRX team</li>\n</ul>\n<p>ðŸ’¡<strong>Pro Tip:</strong> write many granular actions and always write what originated them. It doesnâ€™t really matter if you rewrite some action that does the same thing.Â </p>\n<h2 id=\"reducers\"><a href=\"#reducers\" aria-label=\"reducers permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reducers</h2>\n<p>Reducers are simply pure functions responsible for updating the state object in an immutable manner.Â </p>\n<p>A reducer is a function that receives two parameters: the current state object and an action class, and returns the new state as output.Â </p>\n<p>The new state is <strong>always a newly built object</strong>, and <strong>we never mutate the state</strong>.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">loginReducer</span><span class=\"token punctuation\">(</span>  \n    <span class=\"token parameter\">state<span class=\"token punctuation\">:</span> UserState <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  \n    action<span class=\"token punctuation\">:</span> UserActions</span>  \n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> UserState <span class=\"token punctuation\">{</span>  \n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token keyword\">case</span> UserActionTypes<span class=\"token punctuation\">.</span>LoginSuccess<span class=\"token punctuation\">:</span>  \n            <span class=\"token keyword\">return</span> action<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">;</span>  \n        <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span>  \n            <span class=\"token keyword\">return</span> state<span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This is a dead-simple reducer that simply returns the current state if no action is matched, or returns the actionâ€™s payload as the next state. In a real application, your reducers will end up being much bigger than the example.Â </p>\n<p>There are loads of libraries around to simplify using reducers, but to me, they are rarely worth using.</p>\n<p>For more complex reducers, Iâ€™d recommend to create functions and <strong>keep the reducer functions simple and small</strong>.</p>\n<p>In fact, we can refactor the switch statement by simply using an object and match the action type with the objectâ€™s keys.</p>\n<p>Letâ€™s rewrite that:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">LoginReducerActions</span> <span class=\"token punctuation\">{</span>   \n    <span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">:</span> UserActionTypes<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>  \n        state<span class=\"token punctuation\">:</span> UserState<span class=\"token punctuation\">,</span>   \n        action<span class=\"token punctuation\">:</span> UserActions  \n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> UserState<span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> loginReducerActions<span class=\"token punctuation\">:</span> LoginReducerActions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>   \n    <span class=\"token punctuation\">[</span>UserActionTypes<span class=\"token punctuation\">.</span>LoginSuccess<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>  \n       <span class=\"token parameter\">state<span class=\"token punctuation\">:</span> UserState<span class=\"token punctuation\">,</span>   \n       action<span class=\"token punctuation\">:</span> LoginSuccess</span>  \n    <span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> action<span class=\"token punctuation\">.</span>payload  \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">loginReducer</span><span class=\"token punctuation\">(</span>  \n    <span class=\"token parameter\">state<span class=\"token punctuation\">:</span> UserState <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  \n    action<span class=\"token punctuation\">:</span> UserActions</span>  \n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> UserState <span class=\"token punctuation\">{</span>  \n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>loginReducerActions<span class=\"token punctuation\">.</span><span class=\"token function\">hasOwnProperty</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n       <span class=\"token keyword\">return</span> loginReducerActions<span class=\"token punctuation\">[</span>action<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> state<span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"selectors\"><a href=\"#selectors\" aria-label=\"selectors permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Selectors</h2>\n<p>Selectors are simply functions we define to select information from the storeâ€™s object.Â </p>\n<p>Before we can introduce selectors, letâ€™s see how we would normally select data from the store within a service:Â </p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">DashboardState</span> <span class=\"token punctuation\">{</span>  \n   widgets<span class=\"token punctuation\">:</span> Widget<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DashboardRepository</span> <span class=\"token punctuation\">{</span>  \n    widgets$ <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state<span class=\"token punctuation\">:</span> DashboardState</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token keyword\">return</span> state<span class=\"token punctuation\">.</span>widgets<span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">private</span> store<span class=\"token punctuation\">:</span> Store<span class=\"token operator\">&lt;</span>DashboardState<span class=\"token operator\">></span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Why is this approach not ideal?</p>\n<ul>\n<li>itâ€™s not DRY</li>\n<li>if the storeâ€™s structure will change (and believe me, it will), we need to change the selection everywhere</li>\n<li>the service itself knows about the structure of the store</li>\n<li>No cachingÂ </li>\n</ul>\n<p>Letâ€™s introduce the utility provided by <code class=\"language-text\">@ngrx/store</code> called <code class=\"language-text\">createSelector</code> which was inspired by the React library <code class=\"language-text\">reselect</code>.Â </p>\n<p>For simplicity, I will keep the snippets unified, but you should assume that selectors are created in a separate file and they get exported.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// selectors  </span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createSelector<span class=\"token punctuation\">,</span> createFeatureSelector <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@ngrx/store'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> selectDashboardState <span class=\"token operator\">=</span> <span class=\"token function\">createFeatureSelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dashboard'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> selectAllWidgets <span class=\"token operator\">=</span> <span class=\"token function\">createSelector</span><span class=\"token punctuation\">(</span>  \n    selectDashboardState<span class=\"token punctuation\">,</span>   \n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">state<span class=\"token punctuation\">:</span> DashboardState</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> state<span class=\"token punctuation\">.</span>widgets  \n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// service  </span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DashboardRepository</span> <span class=\"token punctuation\">{</span>  \n    widgets$ <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span>selectAllWidgets<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">private</span> store<span class=\"token punctuation\">:</span> Store<span class=\"token operator\">&lt;</span>DashboardState<span class=\"token operator\">></span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ðŸ’¡<strong>Pro Tip:</strong> selectors are super useful, always write granular selectors and try to encapsulate logic within selectors rather than in your services or components</p>\n<h2 id=\"entities\"><a href=\"#entities\" aria-label=\"entities permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Entities</h2>\n<p>Entities are added by the package <code class=\"language-text\">@ngrx/entity</code>Â .</p>\n<p>As you may have seen if you ever used Redux, the boilerplate for common CRUD operations is time-consuming and redundant.</p>\n<p>NGRX Entity helps us by providing out of the box a set of common operations and selectors that help to reduce the size of our reducers.</p>\n<p>What does our state look like by using this Entity framework?</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">EntityState</span><span class=\"token operator\">&lt;</span><span class=\"token constant\">V</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>    \n  ids<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>     \n  entities<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>   \n      <span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> id<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">V</span>   \n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I normally start by creating an adapter, in a separate file, so we can import it from different files such as the reducer and the selectorsâ€™ files.</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/1600/1*v9EpQXnp-aNUhDNb1oVMSQ.png\"></p>\n<p>export const adapter: EntityAdapter<Widget> = createEntityAdapter<Widget>();</p>\n<p>Letâ€™s use the adapter in our reducer. How does the adapter interact with it?</p>\n<ul>\n<li>it creates an initial state (see the interface <code class=\"language-text\">EntityState</code> above)</li>\n<li>it gives us a series of <em>CRUD</em> operations methods to write reducers on the fly</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> initialState<span class=\"token punctuation\">:</span> DashboardState <span class=\"token operator\">=</span> adapter<span class=\"token punctuation\">.</span><span class=\"token function\">getInitialState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function\">dashboardReducer</span><span class=\"token punctuation\">(</span>  \n    state <span class=\"token operator\">=</span> initialState<span class=\"token punctuation\">,</span>  \n    action<span class=\"token punctuation\">:</span> DashboardActions  \n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> DashboardState <span class=\"token punctuation\">{</span>  \n   <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n       <span class=\"token keyword\">case</span> DashbordActionTypes<span class=\"token punctuation\">.</span>AddWidget<span class=\"token punctuation\">:</span>  \n          <span class=\"token keyword\">const</span> widget<span class=\"token punctuation\">:</span> Widget <span class=\"token operator\">=</span> action<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">;</span>    \n          <span class=\"token keyword\">return</span> adapter<span class=\"token punctuation\">.</span><span class=\"token function\">addOne</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">,</span> state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n   <span class=\"token punctuation\">}</span>\n\n   <span class=\"token comment\">// more ...   </span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ðŸ’¡ <strong>Pro Tip</strong>: <a href=\"https://medium.com/r/?url=https%3A%2F%2Fngrx.io%2Fguide%2Fentity%2Fadapter%23adapter-collection-methods\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Take a look at all the methods available in NGRX Entity</a></p>\n<p>The entity adapter also allows us to kickstart a collection of selectors to query the store.</p>\n<p>Hereâ€™s an example for selecting all the widgets in our dashboardâ€™s state:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> selectAll <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> adapter<span class=\"token punctuation\">.</span><span class=\"token function\">getSelectors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> selectDashboardState <span class=\"token operator\">=</span> createFeatureSelector<span class=\"token operator\">&lt;</span>DashboardState<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token string\">'dashboard'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> selectAllWidgets <span class=\"token operator\">=</span> <span class=\"token function\">createSelector</span><span class=\"token punctuation\">(</span>  \n  selectDashboardState<span class=\"token punctuation\">,</span>  \n  selectAll  \n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ðŸ’¡ <strong>Pro Tip</strong>: <a href=\"https://medium.com/r/?url=https%3A%2F%2Fngrx.io%2Fguide%2Fentity%2Fadapter%23entity-selectors\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Take a look at all the selectors available in NGRX Entity</a></p>\n<h2 id=\"effects\"><a href=\"#effects\" aria-label=\"effects permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Effects</h2>\n<p>Finally, my number one favorite feature in NGRX: <em>Effects</em>.</p>\n<p>As the name suggests, we use effects to manage side-effects in our application. NGRX implements effects as streams emitted by actions, that in most cases return new actions.</p>\n<p>Letâ€™s consider the diagram below:</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/1600/1*zucA-8bRWyhrhxkdMBOpLA.png\"></p>\n<ul>\n<li>an action gets dispatched from somewhere in the application (ex: UI, WebSocket, Timers, etc.)</li>\n<li>the effects intercept the action, for which a side-effect has been defined. The side-effect gets executed</li>\n<li>The side effect, with exceptions, returns a new action</li>\n<li>The action goes through a reducer and updates the store</li>\n</ul>\n<p>As I mentioned, not all side effects will return a new action. We can configure an effect not to dispatch any action if it is not needed, but itâ€™s important that you understand that in most cases we do want to dispatch new actions as a result.Â </p>\n<p>The most practical use-case for effects in <em>NGRX</em> is making <em>HTTP</em> requests:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WidgetsEffects</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span>  \n        <span class=\"token parameter\"><span class=\"token keyword\">private</span> actions$<span class=\"token punctuation\">:</span> Actions<span class=\"token punctuation\">,</span>  \n        <span class=\"token keyword\">private</span> api<span class=\"token punctuation\">:</span> WidgetApiService</span>  \n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    @<span class=\"token function\">Effect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \n    createWidget$<span class=\"token punctuation\">:</span> Observable<span class=\"token operator\">&lt;</span>AddWidgetAction<span class=\"token operator\">></span> <span class=\"token operator\">=</span>   \n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>actions$<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>  \n            <span class=\"token function\">ofType</span><span class=\"token punctuation\">(</span>WidgetsActionTypes<span class=\"token punctuation\">.</span>CreateWidgetRequestStarted<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \n            <span class=\"token function\">mergeMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">action<span class=\"token punctuation\">:</span> CreateWidgetAction</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>  \n                <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span><span class=\"token function\">createWidget</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   \n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \n            <span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">widget<span class=\"token punctuation\">:</span> Widget</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AddWidgetAction</span><span class=\"token punctuation\">(</span>widget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  \n         <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    @<span class=\"token function\">Effect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> dispatch<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>  \n    exportWidgets$<span class=\"token punctuation\">:</span> Observable<span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span>   \n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>actions$<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>  \n            <span class=\"token function\">ofType</span><span class=\"token punctuation\">(</span>WidgetsActionTypes<span class=\"token punctuation\">.</span>ExportWidgets<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \n            <span class=\"token function\">tap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">action<span class=\"token punctuation\">:</span> ExportWidgets</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>  \n                <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span><span class=\"token function\">exportWidgets</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   \n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  \n         <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Letâ€™s break the above snippet down.</p>\n<ul>\n<li>we created a class called <code class=\"language-text\">WidgetsEffects</code></li>\n<li>we import two providers: <code class=\"language-text\">Actions</code> and <code class=\"language-text\">WidgetsApiService</code></li>\n<li><code class=\"language-text\">Actions</code> is a stream of actions. We use the operator <code class=\"language-text\">ofType</code> that helps us filter the actions to only the one we want to listen to</li>\n<li>We create a property on the class and decorate it with <code class=\"language-text\">Effect</code></li>\n<li>This effect is called when an action called <code class=\"language-text\">CREATE_WIDGET_REQUEST</code> is dispatched</li>\n<li>We get the payload from the action and execute a call with our API service</li>\n<li>Once that has successfully been executed, we map it the action <code class=\"language-text\">AddWidgetAction</code> which can be picked up by the reducer and update our store</li>\n<li>In the second effect called <code class=\"language-text\">exportWidgets$</code>Â , we receive an action <code class=\"language-text\">ExportWidgets</code>Â , we use the <code class=\"language-text\">tap</code> operator to execute a side-effect, and thenâ€¦ well, nothing! As we passed the configuration <code class=\"language-text\">{ dispatch: false }</code> we donâ€™t have to return any action</li>\n</ul>\n<h2 id=\"takeaways\"><a href=\"#takeaways\" aria-label=\"takeaways permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Takeaways</h2>\n<ul>\n<li>A state-management solution, be it a library or your own implementation, should always be preferred to local stateÂ </li>\n<li>A single source of truth such as the store helps us managing the state of our application, with a few exceptions such as when the state is transient</li>\n<li>we briefly explored the concept of store, actions, reducers, entities, selectors, and effects, but in the next steps we will go into details into each of these with some more advanced examples</li>\n</ul>\n<p>In the next article, we're going to the store of the application and the stateâ€™s entities. You can find it at the link below:\n<a href=\"https://medium.com/r/?url=https%3A%2F%2Fitnext.io%2Farchitecting-the-store-in-ngrx-e4955641d746\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Architecting the Store in NGRX</a></p>\n<p>Hope you enjoyed this article and stay tuned for the next part of this series!</p>","frontmatter":{"title":"State Management with NGRXâ€Š-â€ŠIntroduction","date":"02.05.2019","category":"angular","featuredImage":"https://cdn-images-1.medium.com/max/1600/1*dlu3ZwrnKXqG1vMbsiemxQ.png","canonical":null},"timeToRead":9}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/state-management-with-ngrx-introduction","prev":{"fields":{"slug":"/building-side-effects-in-ngrx"},"frontmatter":{"title":"Building Side Effects inÂ NGRX","category":"angular"}},"next":{"fields":{"slug":"/writing-scalable-typescript"},"frontmatter":{"title":"Writing scalable Typescript","category":"typescript"}}}}