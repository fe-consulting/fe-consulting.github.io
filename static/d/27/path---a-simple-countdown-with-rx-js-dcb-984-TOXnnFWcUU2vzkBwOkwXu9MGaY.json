{"data":{"markdownRemark":{"html":"<hr>\n<h3 id=\"a-simple-countdown-with-rxjs\"><a href=\"#a-simple-countdown-with-rxjs\" aria-label=\"a simple countdown with rxjs permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A simple Countdown with RxJS</h3>\n<h4 id=\"in-this-tutorial-were-going-to-build-a-very-simple-timer-application-with-only-a-few-lines-of-code-using-rxjs\"><a href=\"#in-this-tutorial-were-going-to-build-a-very-simple-timer-application-with-only-a-few-lines-of-code-using-rxjs\" aria-label=\"in this tutorial were going to build a very simple timer application with only a few lines of code using rxjs permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>In this tutorial, we’re going to build a very simple timer application with only a few lines of code using RxJS.</h4>\n<p><img src=\"https://cdn-images-1.medium.com/max/1600/1*UqfNSA5wgWcEXphLsBXuUg.gif\"></p>\n<p>Type caption for image (optional)  </p>\n<h4 id=\"preview\"><a href=\"#preview\" aria-label=\"preview permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Preview</h4>\n<p>In order to build it, we’re going to use the awesome Stackblitz. You can see a preview of the final result at <a href=\"https://medium.com/r/?url=https%3A%2F%2Frxjs-rajp6s.stackblitz.io\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this link</a>.</p>\n<p>The timer starts automatically when you land on the page, you can click on the time to stop it, and click again to restart the timer. </p>\n<p>When the time ends, the user will be prompted to take a break! It’s a very simple example, so the timer won’t restart.</p>\n<h4 id=\"constants\"><a href=\"#constants\" aria-label=\"constants permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Constants</h4>\n<p>Let’s first define some of the constants we’re going to use:</p>\n<ul>\n<li>We define <code class=\"language-text\">K</code> as we’re going to use this a lot, as we will be dealing with milliseconds, so we assign <code class=\"language-text\">1000</code> as value</li>\n<li>The interval is the amount of time that needs to elapse in order to update the timer. If we set it to <code class=\"language-text\">5000</code>, the timer would be updated every 5 seconds</li>\n<li>We set the minutes we want our timer to be long and its time in milliseconds</li>\n</ul>\n<p>const K = 1000;<br>\nconst INTERVAL = K;<br>\nconst MINUTES = 25;<br>\nconst TIME = MINUTES * K * 60;</p>\n<h4 id=\"stateful-variables\"><a href=\"#stateful-variables\" aria-label=\"stateful variables permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Stateful variables</h4>\n<p>In order to keep the time’s state when pausing/resuming the timer, we define two variables:</p>\n<p>let current: number;<br>\nlet time = TIME;</p>\n<ul>\n<li><code class=\"language-text\">current</code> will be continually updated every second</li>\n<li><code class=\"language-text\">time</code> will be updated when the timer stops</li>\n</ul>\n<h4 id=\"helper-functions\"><a href=\"#helper-functions\" aria-label=\"helper functions permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Helper functions</h4>\n<p>We define some helper functions used by our streams. We want to:</p>\n<ul>\n<li>convert remaining time to milliseconds and seconds</li>\n<li>have functions to display remaining minutes and seconds</li>\n</ul>\n<p>const toMinutes = (ms: number) =><br>\nMath.floor(ms / K / 60);</p>\n<p>const toSeconds = (ms: number) =><br>\nMath.floor(ms / K) % 60;</p>\n<p>const toSecondsString = (ms: number) => {<br>\nconst seconds = toSeconds(ms);<br>\nreturn seconds &#x3C; 10 ? `0${seconds}` : seconds.toString();<br>\n}</p>\n<p>const toMs = (t: number) => t * INTERVAL;</p>\n<p>const currentInterval = () => time / INTERVAL;  </p>\n<p>const toRemainingSeconds = (t: number) => currentInterval() - t;</p>\n<h4 id=\"defining-the-rx-streams\"><a href=\"#defining-the-rx-streams\" aria-label=\"defining the rx streams permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Defining the Rx streams</h4>\n<p>First, we define the <code class=\"language-text\">timer$</code> stream: </p>\n<ul>\n<li>we use the observable creator <code class=\"language-text\">timer</code>, that emits every <code class=\"language-text\">INTERVAL</code> times, which basically means it will emit every second</li>\n</ul>\n<p>The stream will convert the milliseconds emitted from <code class=\"language-text\">timer</code> to the remaining seconds.</p>\n<p>const toggle$ = new BehaviorSubject(true);<br>\nconst remainingSeconds$ = toggle$.pipe(<br>\nswitchMap((running: boolean) => {<br>\nreturn running ? timer(0, INTERVAL) : NEVER;<br>\n}),<br>\nmap(toRemainingSeconds),<br>\ntakeWhile(t => t >= 0)<br>\n);</p>\n<p>Let’s explain detail what this does:</p>\n<p><strong>toggle$</strong> -> true...false...true</p>\n<p>-----</p>\n<p><strong>switchMap</strong> to:</p>\n<p> <strong>if toggle is true -> timer(0, INTERVAL = 1000)</strong> -> 0...1000...2000<br>\n<strong>if toggle is false ? -></strong> NEVER = do not continue</p>\n<p>----</p>\n<p><strong>map(toRemainingSeconds)</strong> -> ms elapsed mapped to remaining seconds (ex. 1500)</p>\n<p>----</p>\n<p><strong>takeWhile(remainingSeconds)</strong> -> complete once <strong>remainingSeconds$'s</strong> value  is no more >= 0</p>\n<p>Let’s consider the operators used:</p>\n<ul>\n<li>the mapper <code class=\"language-text\">toSeconds</code> will convert the milliseconds returned by the observable to the number of seconds that are remaining</li>\n<li>by using the operator <code class=\"language-text\">takeWhile</code>we’re basically telling the <code class=\"language-text\">remainingSeconds$</code> observable to keep going until the seconds remaining are greater or equal than 0</li>\n<li>After that, <code class=\"language-text\">remainingSeconds$</code> will emit its completion callback that we can use to replace the timer with some other content</li>\n</ul>\n<p>Before creating the relative minutes and seconds we will be displaying, we want to be able to stop and resume and timer. </p>\n<p>If <code class=\"language-text\">toggle$</code> is emitted with <code class=\"language-text\">true</code> as value, the timer keeps running, while if it gets emitted with <code class=\"language-text\">false</code> it will stop, as instead of mapping to <code class=\"language-text\">remainingSeconds$</code> it will emit the observable <code class=\"language-text\">NEVER</code> .</p>\n<h4 id=\"pausing-and-resuming-the-timer\"><a href=\"#pausing-and-resuming-the-timer\" aria-label=\"pausing and resuming the timer permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pausing and resuming the timer</h4>\n<p>By using <code class=\"language-text\">fromEvent</code> , we can listen to click events and update the behavior subject by toggling its current value.</p>\n<p>const toggleElement = document.querySelector('.timer');</p>\n<p>fromEvent(toggleElement, ‘click’).subscribe(() => {<br>\ntoggle$.next(!toggle$.value);<br>\n});</p>\n<p>But <code class=\"language-text\">toggle$</code> also does something else: </p>\n<ul>\n<li>every time the timer gets stopped, we want to update the time variable with the current time, so that the next time the timer restarts, it will restart from the current time.</li>\n</ul>\n<p>toggle$.pipe(<br>\nfilter((toggled: boolean) => !toggled)<br>\n).subscribe(() => {<br>\ntime = current;<br>\n});</p>\n<p>Now, we can define the milliseconds observable we’re going to use to display minutes and seconds: </p>\n<p>const ms$ = time$.pipe(<br>\nmap(toMs),<br>\ntap(t => current = t)<br>\n);</p>\n<p>Every time <code class=\"language-text\">ms$</code> emits, we use the <code class=\"language-text\">tap</code> operator to update the stateful variable <code class=\"language-text\">current</code>.</p>\n<p>Next, we’re going to define minutes and seconds by reusing the helper methods we defined earlier in the article.</p>\n<p>const minutes$ = ms$.pipe(<br>\nmap(toMinutesDisplay),<br>\nmap(s => s.toString()),<br>\nstartWith(toMinutesDisplay(time).toString())<br>\n);</p>\n<p>const seconds$ = ms$.pipe(<br>\nmap(toSecondsDisplayString),<br>\nstartWith(toSecondsDisplayString(time).toString())<br>\n);</p>\n<p>And that’s it! Our streams are ready and can now update the DOM.</p>\n<h4 id=\"updating-the-dom\"><a href=\"#updating-the-dom\" aria-label=\"updating the dom permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Updating the DOM</h4>\n<p>We define a simple function called <code class=\"language-text\">updateDom</code> that takes an observable as the first argument and an HTML element as the second one. Every time the source emits, it will update the <code class=\"language-text\">innerHTML</code> of the node.</p>\n<p>// DOM nodes</p>\n<p>const minutesElement = document.querySelector('.minutes');<br>\nconst secondsElement = document.querySelector('.seconds');</p>\n<p>updateDom(minutes$, minutesElement);<br>\nupdateDom(seconds$, secondsElement);</p>\n<p>function updateDom(source$: Observable<string>, element: Element) {<br>\nsource$.subscribe((value) => element.innerHTML = value);<br>\n}</p>\n<p>Lastly, we want to display a message when the timer stops:</p>\n<p>timer$.subscribe({<br>\ncomplete: () => updateDom(of('Take a break!'), toggleElement)<br>\n});</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/1600/1*viwakc1HIU6SKXtrXgTLPw.gif\"></p>\n<p>Type caption for image (optional)  </p>\n<p>You can find the complete code snippet on <a href=\"https://medium.com/r/?url=https%3A%2F%2Fstackblitz.com%2Fedit%2Frxjs-rajp6s%3Ffile%3Dindex.ts\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Stackblitz</a>.</p>\n<p>Hope you enjoyed the article and leave a message if you agree, disagree, or if you would do anything differently!</p>\n<hr>\n<p><em>If you enjoyed this article, follow me on</em> <a href=\"https://medium.com/@.gc\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><em>Medium</em></a> <em>or</em> <a href=\"https://medium.com/r/?url=https%3A%2F%2Ftwitter.com%2Fhome\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><em>Twitter</em></a> <em>for more articles about Angular, RxJS, Typescript and more!</em></p>","frontmatter":{"title":"A simple Countdown with RxJS","date":"06.05.2019","category":"rxjs","featuredImage":""},"timeToRead":5}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/a-simple-countdown-with-rx-js","prev":null,"next":{"fields":{"slug":"/building-side-effects-in-ngrxx"},"frontmatter":{"title":"Building Side Effects in NGRXX","category":"angular"}}}}